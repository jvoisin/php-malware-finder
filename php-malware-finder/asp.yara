import "hash"
include "whitelist.yara"
include "common.yara"

global private rule IsAsp
{
    strings:
        $asp = /<%|@{}/
        $cs = /using .{4,25};/

    condition:
        ($asp or $cs) and filesize < 5MB
}

rule ObfusAsp
{
    strings:
        $ = "ReplacementFor" fullword
        //TODO
    
    condition:
        any of them and not IsWhitelisted
}

rule DangerousAsp
{
    strings:
        $ = "createobject(\"WScript.Shell\")" nocase
        $ = "createobject(\"WScript.Network\")" nocase
        $ = "createobject(\"Shell.Application\")" nocase
        $ = "createobject(\"Scripting.FileSystemObject\")" nocase
        $ = "ProcessStartInfo" fullword

    condition:
        2 of them and not IsWhitelisted
}

