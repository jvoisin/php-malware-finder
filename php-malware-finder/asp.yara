import "hash"
include "whitelist.yara"
include "common.yara"

global private rule IsAsp
{
    strings:
        $asp = /<%|@{}/

    condition:
        $asp and filesize < 5MB
}

rule ObfusAsp
{
    strings:
        $unescape = "unescape" fullword nocase
        $execute = "execute" fullword nocase
    
    condition:
        ((#unescape + #execute) >= 4) and not IsWhitelisted // TODO
}

rule DangerousAsp
{
    strings:
        $ = "createobject(\"WScript.Shell\")" nocase
        $ = "createobject(\"WScript.Network\")" nocase
        $ = "createobject(\"Shell.Application\")" nocase
        $ = "createobject(\"Scripting.FileSystemObject\")" nocase
        $ = "ProcessStartInfo" fullword

    condition:
        2 of them and not IsWhitelisted
}

